{
  "variables": {
    "aws_access_key": "",
    "aws_secret_key": "",
    "output_ami_name": null,
    "source_ami": null,
    "branch_or_sha": "master"
  },
  "builders": [{
    "type": "amazon-ebs",
    "access_key": "{{user `aws_access_key`}}",
    "secret_key": "{{user `aws_secret_key`}}",
    "region": "us-east-2",
    "source_ami": "{{user `source_ami`}}",
    "instance_type": "t3a.small",
    "ssh_username": "ubuntu",
    "ssh_keypair_name": "kevin_kyumin_kp",
    "ssh_private_key_file": "~/.ssh/kevin_kyumin_kp.pem",
    "ami_name": "{{user `output_ami_name`}}"
  }],
  "provisioners": [
    {
      "type": "shell",
      "environment_vars": [
        "BRANCH_OR_SHA={{user `branch_or_sha`}}"
      ],
      "scripts": [
        "./tester_install_secrets.sh",
        "./tester_prepare_rails.sh",
        "./tester_install_services.sh"
      ],
      "timeout": "5m"
    }
  ]
}
