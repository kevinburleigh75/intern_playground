{
  "$schema": "http://json-schema.org/draft-04/schema#",

  "type": "object",
  "properties": {
    "ecosystem_uuid": {"$ref": "#/standard_definitions/uuid"},
    "book": {
      "cnx_identity": {"$ref": "#/standard_definitions/cnx_identity"},
      "contents": {
        "type": "array",
        "items": {
          "type": "object",
          "properties": {
            "container_uuid":         {"$ref": "#/standard_definitions/uuid"},
            "container_parent_uuid":  {"$ref": "#/standard_definitions/uuid"},
            "container_cnx_identity": {"$ref": "#/standard_definitions/cnx_identity"},
            "pools": {
              "type": "array",
              "items": {"$ref": "#/definitions/pool"},
              "minItems": 0,
              "maxItems": 20
            }
          },
          "required": ["container_uuid", "container_parent_uuid", "pools"],
          "additionalProperties": false
        },
        "minItems": 1,
        "maxItems": 500
      }
    },
    "exercises": {
      "type": "array",
      "items": {"$ref": "#/definitions/exercise"},
      "minItems": 0,
      "maxItems": 10000
    },
    "imported_at": {"$ref": "#/standard_definitions/datetime"}
  },
  "required": ["ecosystem_uuid", "book", "exercises", "imported_at"],
  "additionalProperties": false,
  "standard_definitions": {
    "uuid": {
      "type": "string",
      "pattern": "^[a-fA-F0-9]{8}-[a-fA-F0-9]{4}-4[a-fA-F0-9]{3}-[a-fA-F0-9]{4}-[a-fA-F0-9]{12}$"
    },
    "number_between_0_and_1": {
      "type": "number",
      "minimum": 0,
      "maximum": 1
    },
    "non_negative_integer": {
      "type": "integer",
      "minumum": 0
    },
    "datetime": {
      "type": "string",
      "pattern": "^\\d{4}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])(T|t)(0[0-9]|1[0-9]|2[0-3]):([0-5][0-9]):([0-5][0-9]|60)(\\.\\d{1,6})?(Z|z)$"
    },
    "clue_data": {
      "type": "object",
      "properties": {
        "minimum": {"$ref": "#/standard_definitions/number_between_0_and_1"},
        "most_likely": {"$ref": "#/standard_definitions/number_between_0_and_1"},
        "maximum": {"$ref": "#/standard_definitions/number_between_0_and_1"},
        "is_real": {"type": "boolean"},
        "ecosystem_uuid": {"$ref": "#/standard_definitions/uuid"}
      },
      "required": ["minimum", "most_likely", "maximum", "is_real"],
      "additionalProperties": false
    },
    "cnx_identity": {
      "type": "string",
      "pattern": "^[a-fA-F0-9]{8}-[a-fA-F0-9]{4}-4[a-fA-F0-9]{3}-[a-fA-F0-9]{4}-[a-fA-F0-9]{12}@([1-9]{1,}[0-9]|[1-9])(\\.([1-9]{1,}[0-9]|[1-9]))?$"
    },
    "exercise_exclusion": {
      "oneOf": [
        {"$ref": "#/standard_definitions/specific_version_exclusion"},
        {"$ref": "#/standard_definitions/any_version_exclusion"}
      ]
    },
    "specific_version_exclusion": {
      "type": "object",
      "properties": {
        "exercise_uuid": {"$ref": "#/standard_definitions/uuid"}
      },
      "required": ["exercise_uuid"],
      "additionalProperties": false
    },
    "any_version_exclusion": {
      "type": "object",
      "properties": {
        "exercise_group_uuid": {"$ref": "#/standard_definitions/uuid"}
      },
      "required": ["exercise_group_uuid"],
      "additionalProperties": false
    }
  },
  "definitions": {
    "pool": {
      "type": "object",
      "properties": {
        "use_for_clue": {
          "type": "boolean"
        },
        "use_for_personalized_for_assignment_types": {
          "type": "array",
          "items": {
            "type": "string",
            "minLength": 3,
            "maxLength": 100
          },
          "minItems": 0,
          "maxItems": 20
        },
        "exercise_uuids": {
          "type": "array",
          "items": {"$ref": "#/standard_definitions/uuid"},
          "minItems": 0,
          "maxItems": 500
        }
      },
      "required": [
        "use_for_clue",
        "use_for_personalized_for_assignment_types",
        "exercise_uuids"
      ],
      "additionalProperties": false
    },
    "exercise": {
      "type": "object",
      "properties": {
        "exercise_uuid": {"$ref": "#/standard_definitions/uuid"},
        "group_uuid":    {"$ref": "#/standard_definitions/uuid"},
        "version":       {"$ref": "#/standard_definitions/non_negative_integer"},
        "los": {
          "type": "array",
          "items": {"$ref": "#/definitions/lo"},
          "minItems": 1,
          "maxItems": 100
        }
      },
      "required": ["exercise_uuid", "group_uuid", "version", "los"],
      "additionalProperties": false
    },
    "lo": {
      "type": "string",
      "minLength": 1,
      "maxLength": 100
    }
  }
}